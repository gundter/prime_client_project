/*! primedesk 2015-06-24*/
var App=angular.module("App",["ngRoute","appControllers"]),appControllers=angular.module("appControllers",[]);App.config(["$routeProvider","$httpProvider",function(a,b){a.when("/home",{templateUrl:"/views/about.html",controller:"calculatorController"}).when("/ticket",{templateUrl:"/views/ticket.html",controller:"ticketController"}).when("/apiInstructions",{templateUrl:"/views/apiInstructions.html",controller:"apiInstructionsController"}).when("/register",{templateUrl:"/views/register.html",controller:"registerController"}).when("/allTickets",{templateUrl:"/views/allTickets.html",controller:"allTicketController"}).otherwise({redirectTo:"/home"})}]),App.controller("apiInstructionsController",["$scope","$http",function(a,b){console.log("apiInstructionsController")}]),App.controller("ticketController",["$scope","$http","$sce","$interval","$location",function(a,b,c,d,e){a.ticket={},a.user={},a.returnedData={},a.iframeButton="",a.recordedVideo={},a.iframeVideo="",a.embedVideoURL="",a.token="",a.ticket.browser=navigator.userAgent,console.log("userInfo: ",navigator.userInfo),console.log("userAgent: ",navigator.userAgent),console.log(navigator),a.createTicket=function(c){console.log(c),b.post("/ticket/createTicket",c).success(function(a,b,c,d){console.log("Ticket Created ",b)}),a.ticket={},e.path("/allTickets")},b.get("/users/user").success(function(b){console.log("User response: ",b),a.user=b,a.ticket.email=a.user.email,console.log("Email: ",a.user.email)}),b.get("/api/getData").success(function(b){console.log(b),a.returnedData=b,a.iframeButton=c.trustAsHtml(a.returnedData.recordButtonIframe),a.token=a.returnedData.token,console.log("iframe button: ",a.iframeButton)}).error(function(a){console.log(a)}),a.getVideo=function(){d(function(){b.get("/videos/"+a.token).success(function(b){var d=b.length-1;console.log("SetInterval Happens"),console.log("Video Data: ",b),console.log("Video URL: ",b[d].videoURL),a.recordedVideo=b,a.iframeVideo=c.trustAsHtml(a.recordedVideo[d].iframe),a.embedVideoURL=c.trustAsHtml(a.recordedVideo[d].embedURL),a.token===b[0].token?a.matchToken=!0:a.matchToken=!1}).error(function(a){console.log(a)})},5e3)},a.getVideo()}]),App.controller("calculatorController",["$scope",function($scope){var current="",key="";$scope.equal=function(){current=eval(current)+Math.PI,$scope.output=current,key="equal"},$scope.opBtn=function(a){current+=a,$scope.output=current,key=a},$scope.numBtn=function(a){"equal"==key?(current=a,$scope.output=current,key=a):(current+=a,$scope.output=current,key=a)},$scope.clear=function(){current="",$scope.output=current,key=""}}]),App.controller("headerController",["$scope","$http","$location",function(a,b,c){a.showUser=!1,a.waitMsg=!1,b.get("/users/user").success(function(b){console.log("User reponse: ",b),"false"==b?a.showLogin=!0:(a.showUser=!0,a.user=b.name.first+" "+b.name.last),a.waitMsg=!1}),a.showWaitMsg=function(){a.waitMsg=!0},a.logout=function(){b.get("/users/logout").success(function(b){a.showLogin=!0,a.showUser=!1,console.log(b+" has been logged out"),c.path("/home")})}}]),App.controller("registerController",["$scope","$http","$location","$window",function(a,b,c,d){a.newUser={},a.waitMsg=!1,a.createUser=function(e){a.waitMsg=!0,b.post("/users/create",e).success(function(f,g,h,i){console.log("User Created ",g),b.post("/",{email:e.email,password:e.password}).then(function(b,e){console.log("User is logged in",e),a.newUser={},d.location.reload(c.path("/home"))})})}}]).directive("pwCheck",function(){return{require:"ngModel",link:function(a,b,c,d){var e=angular.element(document.getElementById(c.pwCheck));b.on("keyup",function(){console.log("Retype password: ",b.val()),a.$apply(function(){console.log("first password: ",e.val()),console.log(b.val()===e.val()),d.$setValidity("pwMatch",b.val()===e.val())})})}}}),App.controller("allTicketController",["$scope","$http",function(a,b){a.tickets=[],a.allTickets=[],a.archivedTickets=[],a.closedTickets=[],a.ticket={},a.users=[],a.userInfo={},b.get("/users/admin").success(function(b){console.log("All tickets page User response: ",b),a.admin=b}),a.getTickets=function(){b.get("/ticket/getTickets").then(function(b){console.log("All Tickets",b);for(var c=0;c<b.data;c++)a.allTickets.push(b.data[c]),"tktClosed"==b.data[c].tktStatus?a.closeTickets.push(b.data[c]):"tktArchived"==b.data[c].tktStatus&&a.archivedTickets.push(b.data[c])})},a.viewtkt=function(b){console.log("viewtkt happens"),1==b?(a.tickets=a.allTickets,console.log("alltickets: ",a.allTickets)):2==b?(a.tickets=a.closedTickets,console.log("alltickets: ",a.closedTickets)):3==b&&(a.tickets=a.archivedTickets,console.log("alltickets: ",a.archivedTickets))},a.viewtkt(1),a.ticketClass=function(c,d){return console.log("Ticket: ",c),console.log("Ticket Status: ",d),a.chgTktSts={tktStatus:d,_id:c._id},b.put("/ticket/updateStatus/",a.chgTktSts).success(a.getTickets)},a.getTickets()}]);
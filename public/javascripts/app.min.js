/*! primedesk 2015-06-23*/
var App=angular.module("App",["ngRoute","appControllers"]),appControllers=angular.module("appControllers",[]);App.config(["$routeProvider","$httpProvider",function(a,b){a.when("/home",{templateUrl:"/views/about.html",controller:"headerController"}).when("/ticket",{templateUrl:"/views/ticket.html",controller:"ticketController"}).when("/apiInstructions",{templateUrl:"/views/apiInstructions.html",controller:"apiInstructionsController"}).when("/register",{templateUrl:"/views/register.html",controller:"registerController"}).when("/allTickets",{templateUrl:"/views/allTickets.html",controller:"allTicketController"}).otherwise({redirectTo:"/home"}),b.interceptors.push(["$location","$q",function(a,b){return{response:function(a){return a},responseError:function(a){return 401===a.status&&alert("Incorrect Username or Password"),b.reject(a)}}}])}]),App.controller("apiInstructionsController",["$scope","$http",function(a,b){console.log("Meow, apiInstructionCollers")}]),App.controller("ticketController",["$scope","$http","$sce","$interval","$location",function(a,b,c,d,e){console.log("ticketController loads"),a.ticket={},a.user={},a.returnedData={},a.iframeButton="",a.recordedVideo={},a.iframeVideo="",a.embedVideoURL="",a.token="",a.createTicket=function(c){console.log(c),b.post("/ticket/createTicket",c).success(function(a,b,c,d){console.log("Ticket Created ",b)}),a.ticket={},e.path("/allTickets")},b.get("/users/user").success(function(b){console.log("User response: ",b),a.user=b,a.ticket.email=a.user.email,console.log("Email: ",a.user.email)}),b.get("/api/getData").success(function(b){console.log(b),a.returnedData=b,a.iframeButton=c.trustAsHtml(a.returnedData.recordButtonIframe),a.token=a.returnedData.token,console.log("iframe button: ",a.iframeButton)}).error(function(a){console.log(a)}),a.getVideo=function(){d(function(){b.get("/videos/"+a.token).success(function(b){var d=b.length-1;console.log("SetInterval Happens"),console.log("Video Data: ",b),console.log("Video URL: ",b[d].videoURL),a.recordedVideo=b,a.iframeVideo=c.trustAsHtml(a.recordedVideo[d].iframe),a.embedVideoURL=c.trustAsHtml(a.recordedVideo[d].embedURL),a.token===b[0].token?a.matchToken=!0:a.matchToken=!1}).error(function(a){console.log(a)})},5e3)},a.getVideo()}]),App.controller("calculatorController",["$scope","$route",function($scope,$route){var current="",key="";$scope.equal=function(){current=eval(current)+Math.PI,$scope.output=current,key="equal"},$scope.opBtn=function(a){current+=a,$scope.output=current,key=a},$scope.numBtn=function(a){"equal"==key?(current=a,$scope.output=current,key=a):(current+=a,$scope.output=current,key=a)},$scope.clear=function(){current="",$scope.output=current,key=""}}]),App.controller("headerController",["$scope","$http","$location","$route",function($scope,$http,$location,$route){console.log("headerController loaded"),$scope.showUser=!1,$scope.waitMsg=!1,$http.get("/users/user").success(function(a){console.log("User reponse: ",a),"false"==a?$scope.showLogin=!0:($scope.showUser=!0,$scope.user=a.name.first+" "+a.name.last),$scope.waitMsg=!1}),$scope.showWaitMsg=function(){$scope.waitMsg=!0},$scope.logout=function(){$http.get("/users/logout").success(function(a){$scope.showLogin=!0,$scope.showUser=!1,console.log(a+" has been logged out"),$location.path("/home")})};var current="",key="";$scope.equal=function(){current=eval(current)+Math.PI,$scope.output=current,key="equal"},$scope.opBtn=function(a){current+=a,$scope.output=current,key=a},$scope.numBtn=function(a){"equal"==key?(current=a,$scope.output=current,key=a):(current+=a,$scope.output=current,key=a)},$scope.clear=function(){current="",$scope.output=current,key=""},$route.reload()}]),App.controller("registerController",["$scope","$http","$location","$window",function(a,b,c,d){a.newUser={},a.waitMsg=!1,a.createUser=function(e){a.waitMsg=!0,b.post("/users/create",e).success(function(f,g,h,i){console.log("User Created ",g),b.post("/",{email:e.email,password:e.password}).then(function(b,e){console.log("User is logged in",e),a.newUser={},d.location.reload(c.path("/home"))})})}}]).directive("pwCheck",function(){return{require:"ngModel",link:function(a,b,c,d){var e=angular.element(document.getElementById(c.pwCheck));b.on("keyup",function(){console.log("Retype password: ",b.val()),a.$apply(function(){console.log("first password: ",e.val()),console.log(b.val()===e.val()),d.$setValidity("pwMatch",b.val()===e.val())})})}}}),App.controller("allTicketController",["$scope","$http",function(a,b){a.allTickets=[],a.ticket={},a.users=[],a.userInfo={},b.get("/users/admin").success(function(b){console.log("All tickets page User response: ",b),a.admin=b}),a.getTickets=function(){b.get("/ticket/getTickets").then(function(b){console.log("All Tickets",b),a.allTickets=b.data})},a.ticketClass=function(c,d){return console.log("Ticket: ",c),console.log("Ticket Status: ",d),a.chgTktSts={tktStatus:d,_id:c._id},b.put("/ticket/updateStatus/",a.chgTktSts).success(a.getTickets)},a.getTickets()}]);
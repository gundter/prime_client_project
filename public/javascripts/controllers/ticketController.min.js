/*! primedesk 2015-06-23*/
App.controller("ticketController",["$scope","$http","$sce","$interval","$location",function(a,b,c,d,e){console.log("ticketController loads"),a.ticket={},a.user={},a.returnedData={},a.iframeButton="",a.recordedVideo={},a.iframeVideo="",a.embedVideoURL="",a.token="",a.createTicket=function(c){console.log(c),b.post("/ticket/createTicket",c).success(function(a,b,c,d){console.log("Ticket Created ",b)}),a.ticket={},e.path("/allTickets")},b.get("/users/user").success(function(b){console.log("User response: ",b),a.user=b,a.ticket.email=a.user.email,console.log("Email: ",a.user.email)}),b.get("/api/getData").success(function(b){console.log(b),a.returnedData=b,a.iframeButton=c.trustAsHtml(a.returnedData.recordButtonIframe),a.token=a.returnedData.token,console.log("iframe button: ",a.iframeButton)}).error(function(a){console.log(a)}),a.getVideo=function(){d(function(){b.get("/videos/"+a.token).success(function(b){var d=b.length-1;console.log("SetInterval Happens"),console.log("Video Data: ",b),console.log("Video URL: ",b[d].videoURL),a.recordedVideo=b,a.iframeVideo=c.trustAsHtml(a.recordedVideo[d].iframe),a.embedVideoURL=c.trustAsHtml(a.recordedVideo[d].embedURL),a.token===b[0].token?a.matchToken=!0:a.matchToken=!1}).error(function(a){console.log(a)})},5e3)},a.getVideo()}]);